# å€‹æ¡ˆç®¡ç†é é¢æ”¹é€²è¨ˆç•«

## ğŸ¯ æ”¹é€²ç›®æ¨™

1. **ä¿®å¾©æ€§åˆ¥é¡¯ç¤ºå•é¡Œ** - å¥³æ€§ badge é¡è‰²æ”¹ç‚ºå¯è¦‹
2. **é¡¯ç¤ºå»ºç«‹è€…å§“å** - ä¸æ˜¯ emailï¼Œè€Œæ˜¯ä½¿ç”¨è€…çš„çœŸå¯¦å§“å
3. **èª¿æ•´æ“ä½œæ¬Šé™** - æ ¹æ“šè§’è‰²é¡¯ç¤ºæ­£ç¢ºçš„æ“ä½œæŒ‰éˆ•
4. **çµ±ä¸€ç·¨è¼¯é é¢** - è¤‡ç”¨ Create é é¢çš„ç¾è§€è¨­è¨ˆ

## ğŸ“‹ å•é¡Œåˆ†æ

### å•é¡Œ 1ï¼šæ€§åˆ¥é¡¯ç¤º
**ç¾æ³**ï¼š
```cshtml
<span class="badge bg-pink">å¥³</span>
```
**å•é¡Œ**ï¼š`bg-pink` ä¸æ˜¯ Bootstrap æ¨™æº–é¡åˆ¥ï¼Œå¯èƒ½é¡¯ç¤ºç™½åº•

**è§£æ±ºæ–¹æ¡ˆ**ï¼šæ”¹ç”¨æ¨™æº– Bootstrap é¡è‰²

### å•é¡Œ 2ï¼šå»ºç«‹è€…é¡¯ç¤º
**ç¾æ³**ï¼š
```cshtml
<small class="text-muted">@(item.SubmittedBy ?? "ç³»çµ±")</small>
```
**å•é¡Œ**ï¼šé¡¯ç¤ºçš„æ˜¯ç™»å…¥å¸³è™Ÿï¼ˆemailï¼‰ï¼Œä¸æ˜¯ä½¿ç”¨è€…å§“å

**è§£æ±ºæ–¹æ¡ˆ**ï¼šå¾ JWT Token å–å¾— `name` claim

### å•é¡Œ 3ï¼šæ“ä½œæ¬Šé™
**ç¾æ³**ï¼šå·²å¯¦ä½œåŸºæœ¬æ¬Šé™æ§åˆ¶

**éœ€è¦èª¿æ•´**ï¼š
- Adminï¼šç·¨è¼¯ã€åˆªé™¤ã€å¯©æ ¸
- SocialWorkerï¼šå¯©æ ¸
- Assistantï¼šæäº¤å¯©æ ¸ï¼ˆåªèƒ½æ“ä½œè‡ªå·±çš„ï¼‰
- Viewerï¼šåªèƒ½æŸ¥çœ‹

### å•é¡Œ 4ï¼šç·¨è¼¯é é¢
**ç¾æ³**ï¼šEdit.cshtml æ¨£å¼ç°¡é™‹

**è§£æ±ºæ–¹æ¡ˆ**ï¼šè¤‡ç”¨ Create.cshtml çš„è¨­è¨ˆï¼Œå»ºç«‹çµ±ä¸€çš„è¡¨å–®æ¨£å¼

## ğŸ”§ å¯¦ä½œæ­¥é©Ÿ

### Step 1ï¼šä¿®å¾©æ€§åˆ¥é¡¯ç¤ºï¼ˆç«‹å³ä¿®å¾©ï¼‰
- å„ªå…ˆç´šï¼šâ­â­â­
- é›£åº¦ï¼šç°¡å–®
- æ™‚é–“ï¼š5 åˆ†é˜

**ä¿®æ”¹å…§å®¹**ï¼š
- å°‡ `bg-pink` æ”¹ç‚º `bg-danger` æˆ– `bg-warning`
- æˆ–è‡ªè¨‚ CSS é¡åˆ¥

### Step 2ï¼šé¡¯ç¤ºå»ºç«‹è€…å§“åï¼ˆé‡è¦ï¼‰
- å„ªå…ˆç´šï¼šâ­â­â­
- é›£åº¦ï¼šä¸­ç­‰
- æ™‚é–“ï¼š15 åˆ†é˜

**éœ€è¦ä¿®æ”¹**ï¼š
1. Controllerï¼šå–å¾—ä½¿ç”¨è€…å§“å
2. Viewï¼šé¡¯ç¤ºå§“åè€Œé email

**å¯¦ä½œæ–¹å¼**ï¼š
```csharp
// åœ¨ Controller ä¸­
var userName = User.FindFirst("name")?.Value ?? User.Identity?.Name ?? "ç³»çµ±";
```

### Step 3ï¼šèª¿æ•´æ“ä½œæŒ‰éˆ•ï¼ˆåŠŸèƒ½èª¿æ•´ï¼‰
- å„ªå…ˆç´šï¼šâ­â­â­
- é›£åº¦ï¼šä¸­ç­‰
- æ™‚é–“ï¼š20 åˆ†é˜

**éœ€è¦èª¿æ•´**ï¼š
- ç§»é™¤ SocialWorker çš„ç·¨è¼¯æŒ‰éˆ•ï¼ˆåªä¿ç•™å¯©æ ¸ï¼‰
- ç¢ºä¿ Admin æœ‰æ‰€æœ‰æ¬Šé™
- Assistant åªèƒ½çœ‹åˆ°è‡ªå·±çš„å€‹æ¡ˆ

### Step 4ï¼šç¾åŒ–ç·¨è¼¯é é¢ï¼ˆé«”é©—å„ªåŒ–ï¼‰
- å„ªå…ˆç´šï¼šâ­â­
- é›£åº¦ï¼šä¸­ç­‰
- æ™‚é–“ï¼š30 åˆ†é˜

**å¯¦ä½œæ–¹å¼**ï¼š
- é¸é … Aï¼šç›´æ¥è¤‡è£½ Create.cshtml æ”¹æˆ Edit
- é¸é … Bï¼šå»ºç«‹å…±ç”¨çš„ Partial View
- **å»ºè­°**ï¼šé¸é … Aï¼ˆè¼ƒå¿«é€Ÿï¼‰

### Step 5ï¼šåŠ å…¥å¯©æ ¸è³‡è¨Šé¡¯ç¤ºï¼ˆé¡å¤–å„ªåŒ–ï¼‰
- å„ªå…ˆç´šï¼šâ­
- é›£åº¦ï¼šç°¡å–®
- æ™‚é–“ï¼š10 åˆ†é˜

**é¡¯ç¤ºå…§å®¹**ï¼š
- å¯©æ ¸è€…å§“å
- å¯©æ ¸æ™‚é–“
- å¯©æ ¸ç‹€æ…‹

## ğŸ“ è©³ç´°å¯¦ä½œè¨ˆç•«

### ğŸ¨ ä¿®æ”¹ 1ï¼šæ€§åˆ¥ Badge é¡è‰²

**æª”æ¡ˆ**ï¼š`Views/Case/Index.cshtml`

**ä¿®æ”¹å‰**ï¼š
```cshtml
else if (item.Gender == "F")
{
    <span class="badge bg-pink">å¥³</span>
}
```

**ä¿®æ”¹å¾Œ**ï¼š
```cshtml
else if (item.Gender == "F" || item.Gender == "å¥³")
{
    <span class="badge bg-danger">å¥³</span>
}
```

**é¡è‰²é¸é …**ï¼š
- `bg-danger`ï¼ˆç´…è‰²ï¼‰
- `bg-warning`ï¼ˆé»ƒè‰²ï¼‰
- `bg-info`ï¼ˆæ·ºè—è‰²ï¼‰
- è‡ªè¨‚ `bg-female`ï¼ˆç²‰ç´…è‰²ï¼‰

---

### ğŸ‘¤ ä¿®æ”¹ 2ï¼šé¡¯ç¤ºå»ºç«‹è€…å§“å

**æª”æ¡ˆ**ï¼š`Views/Case/Index.cshtml`

**ä¿®æ”¹å‰**ï¼š
```cshtml
<td>
    <small class="text-muted">@(item.SubmittedBy ?? "ç³»çµ±")</small>
</td>
```

**ä¿®æ”¹å¾Œ**ï¼šéœ€è¦åœ¨ Controller æº–å‚™è³‡æ–™

**é¸é … A**ï¼šåœ¨ View ä¸­ç›´æ¥è™•ç†ï¼ˆç°¡å–®ä½†æ•ˆèƒ½è¼ƒå·®ï¼‰
```cshtml
<td>
    @{
        var displayName = item.SubmittedBy ?? "ç³»çµ±";
        // å¦‚æœæ˜¯ emailï¼Œåªé¡¯ç¤º @ å‰é¢çš„éƒ¨åˆ†
        if (displayName.Contains("@"))
        {
            displayName = displayName.Split('@')[0];
        }
    }
    <small class="text-muted">@displayName</small>
</td>
```

**é¸é … B**ï¼šåœ¨ Controller å»ºç«‹ ViewModelï¼ˆæ¨è–¦ï¼‰
```csharp
// å»ºç«‹æ–°çš„ ViewModel
public class CaseListItemViewModel
{
    public Case Case { get; set; }
    public string SubmittedByDisplayName { get; set; }
    public string ReviewedByDisplayName { get; set; }
}
```

**å»ºè­°**ï¼šå…ˆç”¨é¸é … A å¿«é€Ÿä¿®å¾©ï¼Œä¹‹å¾Œæœ‰æ™‚é–“å†é‡æ§‹æˆé¸é … B

---

### ğŸ” ä¿®æ”¹ 3ï¼šèª¿æ•´æ“ä½œæ¬Šé™

**æª”æ¡ˆ**ï¼š`Views/Case/Index.cshtml`

**éœ€æ±‚åˆ†æ**ï¼š
| è§’è‰² | æŸ¥çœ‹ | ç·¨è¼¯ | åˆªé™¤ | æäº¤å¯©æ ¸ | å¯©æ ¸ | é–å®š |
|------|------|------|------|----------|------|------|
| Admin | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… |
| SocialWorker | âœ… | âŒ | âŒ | âŒ | âœ… | âœ… |
| Assistant | âœ…(è‡ªå·±çš„) | âŒ | âŒ | âœ…(è‡ªå·±çš„) | âŒ | âŒ |
| Viewer | âœ… | âŒ | âŒ | âŒ | âŒ | âŒ |

**ä¿®æ”¹é‡é»**ï¼š
```cshtml
<!-- ç·¨è¼¯æŒ‰éˆ• - åªæœ‰ Admin å¯ä»¥ -->
@if (isAdmin)
{
    <a href="@Url.Action("Edit", "Case", new { id = item.CaseId })" 
       class="btn btn-sm btn-outline-primary" title="ç·¨è¼¯">
        <i class="bi bi-pencil"></i>
    </a>
}

<!-- å¯©æ ¸æŒ‰éˆ• - Admin å’Œ SocialWorker å¯ä»¥ -->
@if ((isSocialWorker || isAdmin) && item.SubmittedAt != null && item.ReviewedAt == null)
{
    <!-- å¯©æ ¸ä¸‹æ‹‰é¸å–® -->
}
```

---

### ğŸ¨ ä¿®æ”¹ 4ï¼šç¾åŒ–ç·¨è¼¯é é¢

**ç›®æ¨™**ï¼šè®“ Edit.cshtml èˆ‡ Create.cshtml æœ‰ä¸€è‡´çš„å¤–è§€

**å¯¦ä½œæ–¹å¼**ï¼š

#### é¸é … Aï¼šç›´æ¥è¤‡è£½ä¿®æ”¹ï¼ˆæ¨è–¦ï¼‰
1. è¤‡è£½ `Create.cshtml` çš„ HTML çµæ§‹
2. ä¿®æ”¹æ¨™é¡Œç‚ºã€Œç·¨è¼¯å€‹æ¡ˆã€
3. ä¿®æ”¹è¡¨å–® action ç‚º `Edit`
4. åŠ å…¥éš±è—æ¬„ä½ `CaseId`
5. é å¡«ç¾æœ‰è³‡æ–™

#### é¸é … Bï¼šå»ºç«‹å…±ç”¨ Partial View
1. å»ºç«‹ `_CaseForm.cshtml`
2. åœ¨ Create å’Œ Edit ä¸­å¼•ç”¨
3. è¼ƒè¤‡é›œä½†å¯é‡ç”¨

**å»ºè­°**ï¼šé¸é … Aï¼ˆå¿«é€Ÿä¸”ç›´è§€ï¼‰

**éœ€è¦çš„ ViewModel**ï¼š
```csharp
public class CaseEditViewModel
{
    public Case Case { get; set; }
    public List<City> Cities { get; set; }
    public List<District> Districts { get; set; }
    public List<School> Schools { get; set; }
    public List<SelectListItem> GenderOptions { get; set; }
}
```

---

### ğŸ“Š ä¿®æ”¹ 5ï¼šåŠ å…¥å¯©æ ¸è³‡è¨Šé¡¯ç¤º

**æª”æ¡ˆ**ï¼š`Views/Case/Index.cshtml`

**åœ¨ç‹€æ…‹æ¬„ä½åŠ å…¥å·¥å…·æç¤º**ï¼š
```cshtml
<td>
    @{
        var statusClass = "";
        var statusText = "";
        var tooltipText = "";
        
        if (item.ReviewedAt != null)
        {
            statusClass = "bg-success";
            statusText = "å·²å¯©æ ¸";
            tooltipText = $"å¯©æ ¸è€…ï¼š{item.ReviewedBy}\nå¯©æ ¸æ™‚é–“ï¼š{item.ReviewedAt:yyyy/MM/dd HH:mm}";
        }
        // ... å…¶ä»–ç‹€æ…‹
    }
    <span class="badge @statusClass" 
          data-bs-toggle="tooltip" 
          data-bs-placement="top" 
          title="@tooltipText">
        @statusText
    </span>
</td>
```

## ğŸš€ å¯¦ä½œé †åºå»ºè­°

### ç¬¬ä¸€éšæ®µï¼šç·Šæ€¥ä¿®å¾©ï¼ˆ30åˆ†é˜ï¼‰
1. âœ… ä¿®å¾©æ€§åˆ¥ Badge é¡è‰²
2. âœ… èª¿æ•´å»ºç«‹è€…é¡¯ç¤ºï¼ˆæš«æ™‚æ–¹æ¡ˆï¼‰
3. âœ… èª¿æ•´æ“ä½œæŒ‰éˆ•æ¬Šé™

### ç¬¬äºŒéšæ®µï¼šåŠŸèƒ½å®Œå–„ï¼ˆ1å°æ™‚ï¼‰
4. âœ… ç¾åŒ–ç·¨è¼¯é é¢
5. âœ… å®Œå–„å¯©æ ¸è³‡è¨Šé¡¯ç¤º
6. âœ… æ¸¬è©¦æ‰€æœ‰è§’è‰²çš„æ¬Šé™

### ç¬¬ä¸‰éšæ®µï¼šé«”é©—å„ªåŒ–ï¼ˆè¦–éœ€æ±‚ï¼‰
7. å»ºç«‹ ViewModel é‡æ§‹
8. åŠ å…¥è¼‰å…¥å‹•ç•«
9. åŠ å…¥æ“ä½œç¢ºèªå°è©±æ¡†
10. åŠ å…¥ç¯©é¸å’Œæœå°‹åŠŸèƒ½

## ğŸ§ª æ¸¬è©¦æª¢æŸ¥æ¸…å–®

### é¡¯ç¤ºæ¸¬è©¦
- [ ] ç”·æ€§é¡¯ç¤ºè—è‰² badge
- [ ] å¥³æ€§é¡¯ç¤ºå¯è¦‹é¡è‰² badgeï¼ˆéç™½è‰²ï¼‰
- [ ] å»ºç«‹è€…é¡¯ç¤ºä½¿ç”¨è€…å§“å
- [ ] å¯©æ ¸ç‹€æ…‹æ­£ç¢ºé¡¯ç¤º
- [ ] å¯©æ ¸è³‡è¨Šé¡¯ç¤ºå®Œæ•´

### æ¬Šé™æ¸¬è©¦
- [ ] Admin å¯ä»¥ç·¨è¼¯å’Œåˆªé™¤
- [ ] SocialWorker åªèƒ½å¯©æ ¸ï¼Œç„¡æ³•ç·¨è¼¯åˆªé™¤
- [ ] Assistant åªèƒ½æäº¤è‡ªå·±çš„å€‹æ¡ˆ
- [ ] Viewer åªæœ‰æŸ¥çœ‹æŒ‰éˆ•

### ç·¨è¼¯é é¢æ¸¬è©¦
- [ ] ç·¨è¼¯é é¢æ¨£å¼ç¾è§€
- [ ] åŸå¸‚/åœ°å€è¯å‹•æ­£å¸¸
- [ ] è³‡æ–™æ­£ç¢ºé å¡«
- [ ] å„²å­˜åŠŸèƒ½æ­£å¸¸

## ğŸ“š ç›¸é—œæª”æ¡ˆ

### éœ€è¦ä¿®æ”¹çš„æª”æ¡ˆ
1. `Views/Case/Index.cshtml` - åˆ—è¡¨é é¢
2. `Views/Case/Edit.cshtml` - ç·¨è¼¯é é¢
3. `Controllers/Mvc/CaseController.cs` - æ§åˆ¶å™¨
4. `wwwroot/css/site.css` - è‡ªè¨‚æ¨£å¼ï¼ˆå¦‚éœ€è¦ï¼‰

### åƒè€ƒæª”æ¡ˆ
1. `Views/Case/Create.cshtml` - åƒè€ƒè¨­è¨ˆ
2. `Views/Shared/_Layout.cshtml` - Bootstrap ç‰ˆæœ¬ç¢ºèª

## ğŸ’¡ é¡å¤–å»ºè­°

### CSS è‡ªè¨‚é¡è‰²ï¼ˆå¦‚æœéœ€è¦ç²‰ç´…è‰²ï¼‰
```css
/* wwwroot/css/site.css */
.bg-female {
    background-color: #ff69b4 !important; /* ç²‰ç´…è‰² */
    color: white;
}
```

### é¡¯ç¤ºåç¨±è™•ç†å‡½æ•¸
```javascript
// åœ¨ View ä¸­ä½¿ç”¨ JavaScript è™•ç†
function getDisplayName(email) {
    if (!email || !email.includes('@')) return email || 'ç³»çµ±';
    return email.split('@')[0];
}
```

## âœ… å®Œæˆæ¨™æº–

- [x] æ€§åˆ¥ badge é¡è‰²æ¸…æ™°å¯è¦‹
- [x] å»ºç«‹è€…é¡¯ç¤ºä½¿ç”¨è€…å§“åè€Œé email
- [x] æ¬Šé™æŒ‰éˆ•ç¬¦åˆè§’è‰²éœ€æ±‚
- [x] ç·¨è¼¯é é¢ç¾è§€ä¸”åŠŸèƒ½å®Œæ•´
- [x] æ‰€æœ‰è§’è‰²æ¸¬è©¦é€šé

---

æº–å‚™å¥½é–‹å§‹å¯¦ä½œäº†å—ï¼Ÿæˆ‘å€‘å¯ä»¥ä¸€æ­¥ä¸€æ­¥ä¾†ï¼
