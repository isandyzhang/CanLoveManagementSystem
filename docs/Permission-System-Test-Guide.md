# 權限系統測試指南

## 🎯 測試目標

驗證權限系統是否按照設計正確運作，包括：
- 角色權限控制
- 個案審核流程
- 個案鎖定機制
- 視圖權限顯示

## 🧪 測試步驟

### 1. 準備測試環境

1. **確保應用程式正在運行**
   ```bash
   dotnet run
   ```

2. **準備不同角色的測試帳號**
   - Admin 帳號
   - SocialWorker 帳號  
   - Assistant 帳號
   - Viewer 帳號

### 2. 測試角色權限

#### 2.1 Admin 角色測試
- [ ] 可以查看所有個案
- [ ] 可以建立新個案
- [ ] 可以編輯所有個案
- [ ] 可以審核個案
- [ ] 可以鎖定/解鎖個案
- [ ] 可以刪除個案
- [ ] 可以管理學校

#### 2.2 SocialWorker 角色測試
- [ ] 可以查看所有個案
- [ ] 可以編輯個案
- [ ] 可以審核個案
- [ ] 可以鎖定/解鎖個案
- [ ] 不能刪除個案
- [ ] 不能管理學校

#### 2.3 Assistant 角色測試
- [ ] 只能查看自己建立的個案
- [ ] 可以建立新個案
- [ ] 可以提交個案審核
- [ ] 不能編輯已提交的個案
- [ ] 不能審核個案
- [ ] 不能刪除個案

#### 2.4 Viewer 角色測試
- [ ] 可以查看個案列表
- [ ] 可以查看個案詳情
- [ ] 不能建立新個案
- [ ] 不能編輯個案
- [ ] 不能審核個案
- [ ] 不能刪除個案

### 3. 測試個案審核流程

#### 3.1 Assistant 建立個案
1. 使用 Assistant 帳號登入
2. 點擊「新增個案」
3. 填寫個案基本資料
4. 確認個案狀態為「草稿」

#### 3.2 Assistant 提交審核
1. 在個案列表中點擊「提交審核」按鈕
2. 確認個案狀態變為「待審核」
3. 確認 Assistant 無法再編輯此個案

#### 3.3 SocialWorker 審核個案
1. 使用 SocialWorker 帳號登入
2. 在個案列表中看到「待審核」個案
3. 點擊審核按鈕，選擇「通過審核」
4. 確認個案狀態變為「已審核」

#### 3.4 測試退回流程
1. 建立新的待審核個案
2. SocialWorker 選擇「退回修改」
3. 確認個案狀態回到「草稿」
4. Assistant 可以重新編輯和提交

### 4. 測試個案鎖定機制

#### 4.1 鎖定個案
1. SocialWorker 或 Admin 點擊鎖定按鈕
2. 確認個案狀態顯示「已鎖定」
3. 其他使用者無法編輯此個案

#### 4.2 解鎖個案
1. 鎖定者點擊解鎖按鈕
2. 確認個案狀態回到正常
3. 其他使用者可以編輯此個案

### 5. 測試視圖權限

#### 5.1 導航列權限
- [ ] Assistant 看到「新增個案」連結
- [ ] SocialWorker 看到「待審核個案」連結
- [ ] Admin 看到「學校管理」連結
- [ ] Viewer 只看到基本導航

#### 5.2 個案列表權限
- [ ] 不同角色看到不同的操作按鈕
- [ ] 審核狀態正確顯示
- [ ] 建立者資訊正確顯示

## 🐛 常見問題排查

### 問題 1：權限檢查失敗
**症狀**：使用者無法存取應該有權限的功能
**解決方案**：
1. 檢查 Azure AD App Roles 設定
2. 確認 `Program.cs` 中的授權策略
3. 檢查使用者角色分配

### 問題 2：個案狀態不正確
**症狀**：個案狀態顯示錯誤
**解決方案**：
1. 檢查資料庫中的審核欄位
2. 確認 Controller 中的狀態更新邏輯
3. 檢查視圖中的狀態判斷邏輯

### 問題 3：按鈕不顯示
**症狀**：應該顯示的操作按鈕沒有出現
**解決方案**：
1. 檢查視圖中的角色判斷邏輯
2. 確認個案狀態條件
3. 檢查 Bootstrap 和 JavaScript 載入

## 📊 測試結果記錄

### 測試日期：___________
### 測試人員：___________

| 測試項目 | Admin | SocialWorker | Assistant | Viewer | 備註 |
|---------|-------|--------------|-----------|--------|------|
| 查看個案 | ✅/❌ | ✅/❌ | ✅/❌ | ✅/❌ | |
| 建立個案 | ✅/❌ | ✅/❌ | ✅/❌ | ✅/❌ | |
| 編輯個案 | ✅/❌ | ✅/❌ | ✅/❌ | ✅/❌ | |
| 審核個案 | ✅/❌ | ✅/❌ | ✅/❌ | ✅/❌ | |
| 刪除個案 | ✅/❌ | ✅/❌ | ✅/❌ | ✅/❌ | |
| 鎖定個案 | ✅/❌ | ✅/❌ | ✅/❌ | ✅/❌ | |

### 審核流程測試
- [ ] 建立個案 → 草稿狀態
- [ ] 提交審核 → 待審核狀態  
- [ ] 通過審核 → 已審核狀態
- [ ] 退回修改 → 草稿狀態

### 發現的問題
1. ________________________________
2. ________________________________
3. ________________________________

### 修復建議
1. ________________________________
2. ________________________________
3. ________________________________
