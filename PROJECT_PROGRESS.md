# CanLove Backend å°ˆæ¡ˆé€²åº¦è¦åŠƒ

## ğŸ“‹ å°ˆæ¡ˆæ¦‚è¿°

**ç›®æ¨™**ï¼šå»ºç«‹ä¸€å€‹åŒæ™‚æ”¯æ´ MVC å’Œ Web API çš„å€‹æ¡ˆç®¡ç†ç³»çµ±å¾Œç«¯

**æŠ€è¡“æ£§**ï¼š
- .NET 9.0
- Entity Framework Core (Code First)
- Azure SQL Database
- Azure Key Vault
- ASP.NET Core MVC + Web API

---

## âœ… å·²å®Œæˆé …ç›®

### 1. åŸºç¤æ¶æ§‹è¨­å®š
- [x] å°ˆæ¡ˆå»ºç«‹ (.NET 9.0)
- [x] Entity Framework Core è¨­å®š
- [x] Azure Key Vault æ•´åˆ
- [x] è³‡æ–™åº«é€£ç·šè¨­å®š

### 2. è³‡æ–™æ¨¡å‹é‡æ§‹
- [x] Models è³‡æ–™å¤¾é‡æ–°åˆ†é¡
  - `Core/` - æ ¸å¿ƒå¯¦é«” (Case)
  - `CaseDetails/` - å€‹æ¡ˆè©³ç´°è³‡è¨Š
  - `Options/` - é¸é …è¡¨ (City, District, School ç­‰)
  - `History/` - æ­·å²è¨˜éŒ„
  - `Audit/` - å¯©è¨ˆè¨˜éŒ„
- [x] Namespace çµ±ä¸€æ•´ç†
- [x] Code First Migration å»ºç«‹

### 3. è³‡æ–™åº«è¨­å®š
- [x] å¾ Database First è½‰æ›ç‚º Code First
- [x] åˆå§‹ Migration å»ºç«‹
- [x] Azure SQL é€£ç·šè¨­å®š
- [x] Key Vault é€£ç·šå­—ä¸²ç®¡ç†

---

## ğŸš§ é€²è¡Œä¸­é …ç›®

### ç›®å‰ç‹€æ…‹
- åŸºç¤æ¶æ§‹å®Œæˆ
- è³‡æ–™æ¨¡å‹å°±ç·’
- æº–å‚™é–‹å§‹å»ºç«‹ Controllers å’Œ Services

---

## ğŸ“ å¾…å®Œæˆé …ç›®

### 1. Controllers å±¤ (é«˜å„ªå…ˆç´š)
```
Controllers/
â”œâ”€â”€ Api/
â”‚   â”œâ”€â”€ CaseController.cs          # å€‹æ¡ˆç®¡ç† API
â”‚   â”œâ”€â”€ CaseDetailController.cs    # å€‹æ¡ˆè©³ç´°è³‡è¨Š API
â”‚   â”œâ”€â”€ CaseHistoryController.cs   # å€‹æ¡ˆæ­·å² API
â”‚   â”œâ”€â”€ OptionSetController.cs     # é¸é …è¡¨ API
â”‚   â””â”€â”€ UserController.cs          # ä½¿ç”¨è€…ç®¡ç† API
â”œâ”€â”€ Mvc/
â”‚   â”œâ”€â”€ HomeController.cs          # é¦–é 
â”‚   â”œâ”€â”€ CaseController.cs          # å€‹æ¡ˆç®¡ç†é é¢
â”‚   â”œâ”€â”€ CaseDetailController.cs    # å€‹æ¡ˆè©³ç´°é é¢
â”‚   â””â”€â”€ ReportController.cs        # å ±è¡¨é é¢
â””â”€â”€ Shared/
    â””â”€â”€ BaseController.cs          # åŸºç¤ Controller
```

### 2. Services å±¤ (é«˜å„ªå…ˆç´š)
```
Services/
â”œâ”€â”€ ICaseService.cs                # å€‹æ¡ˆæœå‹™ä»‹é¢
â”œâ”€â”€ CaseService.cs                 # å€‹æ¡ˆæœå‹™å¯¦ä½œ
â”œâ”€â”€ ICaseDetailService.cs          # å€‹æ¡ˆè©³ç´°æœå‹™ä»‹é¢
â”œâ”€â”€ CaseDetailService.cs           # å€‹æ¡ˆè©³ç´°æœå‹™å¯¦ä½œ
â”œâ”€â”€ IOptionSetService.cs           # é¸é …è¡¨æœå‹™ä»‹é¢
â”œâ”€â”€ OptionSetService.cs            # é¸é …è¡¨æœå‹™å¯¦ä½œ
â”œâ”€â”€ IFileStorageService.cs         # æª”æ¡ˆå„²å­˜æœå‹™
â”œâ”€â”€ FileStorageService.cs          # æª”æ¡ˆå„²å­˜æœå‹™å¯¦ä½œ
â””â”€â”€ IAuditService.cs               # å¯©è¨ˆæœå‹™
    â””â”€â”€ AuditService.cs            # å¯©è¨ˆæœå‹™å¯¦ä½œ
```

### 3. DTOs å’Œé©—è­‰ (ä¸­å„ªå…ˆç´š)
```
DTOs/
â”œâ”€â”€ Case/
â”‚   â”œâ”€â”€ CreateCaseDto.cs
â”‚   â”œâ”€â”€ UpdateCaseDto.cs
â”‚   â”œâ”€â”€ CaseResponseDto.cs
â”‚   â””â”€â”€ CaseListDto.cs
â”œâ”€â”€ CaseDetail/
â”‚   â”œâ”€â”€ CreateCaseDetailDto.cs
â”‚   â”œâ”€â”€ UpdateCaseDetailDto.cs
â”‚   â””â”€â”€ CaseDetailResponseDto.cs
â””â”€â”€ Validators/
    â”œâ”€â”€ CreateCaseDtoValidator.cs
    â”œâ”€â”€ UpdateCaseDtoValidator.cs
    â””â”€â”€ CaseDetailDtoValidator.cs
```

### 4. èªè­‰å’Œæˆæ¬Š (ä¸­å„ªå…ˆç´š)
```
Auth/
â”œâ”€â”€ JwtHelper.cs                   # JWT å·¥å…·é¡
â”œâ”€â”€ PasswordService.cs             # å¯†ç¢¼æœå‹™
â”œâ”€â”€ IAuthService.cs                # èªè­‰æœå‹™ä»‹é¢
â”œâ”€â”€ AuthService.cs                 # èªè­‰æœå‹™å¯¦ä½œ
â””â”€â”€ Middleware/
    â””â”€â”€ JwtMiddleware.cs           # JWT ä¸­ä»‹è»Ÿé«”
```

### 5. é…ç½®å’Œä¸­ä»‹è»Ÿé«” (ä¸­å„ªå…ˆç´š)
```
Middleware/
â”œâ”€â”€ ExceptionMiddleware.cs         # ä¾‹å¤–è™•ç†ä¸­ä»‹è»Ÿé«”
â”œâ”€â”€ LoggingMiddleware.cs           # æ—¥èªŒä¸­ä»‹è»Ÿé«”
â””â”€â”€ RequestValidationMiddleware.cs # è«‹æ±‚é©—è­‰ä¸­ä»‹è»Ÿé«”
```

### 6. å·¥å…·é¡å’Œæ“´å±• (ä½å„ªå…ˆç´š)
```
Utils/
â”œâ”€â”€ DateTimeHelper.cs              # æ—¥æœŸæ™‚é–“å·¥å…·
â”œâ”€â”€ StringHelper.cs                # å­—ä¸²å·¥å…·
â””â”€â”€ ValidationHelper.cs            # é©—è­‰å·¥å…·

Extensions/
â”œâ”€â”€ ServiceCollectionExtensions.cs # æœå‹™è¨»å†Šæ“´å±•
â”œâ”€â”€ ApplicationBuilderExtensions.cs # æ‡‰ç”¨ç¨‹å¼å»ºæ§‹æ“´å±•
â””â”€â”€ DbContextExtensions.cs         # DbContext æ“´å±•
```

---

## ğŸ¯ å¯¦ä½œå„ªå…ˆé †åº

### ç¬¬ä¸€éšæ®µï¼šæ ¸å¿ƒåŠŸèƒ½ (1-2 é€±)
1. **å»ºç«‹ Controllers ç›®éŒ„çµæ§‹**
2. **å¯¦ä½œå€‹æ¡ˆç®¡ç† API (CRUD)**
3. **å»ºç«‹ Services å±¤**
4. **åŸºæœ¬ DTOs å’Œé©—è­‰**

### ç¬¬äºŒéšæ®µï¼šé€²éšåŠŸèƒ½ (1-2 é€±)
1. **èªè­‰å’Œæˆæ¬Šç³»çµ±**
2. **å€‹æ¡ˆè©³ç´°è³‡è¨Šç®¡ç†**
3. **æª”æ¡ˆä¸Šå‚³åŠŸèƒ½**
4. **å¯©è¨ˆè¨˜éŒ„**

### ç¬¬ä¸‰éšæ®µï¼šå®Œå–„åŠŸèƒ½ (1 é€±)
1. **MVC é é¢**
2. **å ±è¡¨åŠŸèƒ½**
3. **æ•ˆèƒ½å„ªåŒ–**
4. **éŒ¯èª¤è™•ç†**

---

## ğŸ—ï¸ æ¶æ§‹è¨­è¨ˆ

### MVC + Web API æ··åˆæ¶æ§‹
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Frontend      â”‚    â”‚   Mobile App    â”‚
â”‚   (React)       â”‚    â”‚   (Future)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                      â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚   Controllers        â”‚
          â”‚   â”œâ”€â”€ Api/           â”‚
          â”‚   â””â”€â”€ Mvc/           â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚   Services           â”‚
          â”‚   (Business Logic)   â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚   Data Layer         â”‚
          â”‚   â”œâ”€â”€ DbContext      â”‚
          â”‚   â””â”€â”€ Models         â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### API è·¯ç”±è¨­è¨ˆ
```
/api/v1/
â”œâ”€â”€ cases/                    # å€‹æ¡ˆç®¡ç†
â”œâ”€â”€ case-details/            # å€‹æ¡ˆè©³ç´°
â”œâ”€â”€ case-history/            # å€‹æ¡ˆæ­·å²
â”œâ”€â”€ option-sets/             # é¸é …è¡¨
â””â”€â”€ users/                   # ä½¿ç”¨è€…ç®¡ç†

/mvc/
â”œâ”€â”€ /                        # é¦–é 
â”œâ”€â”€ /cases                   # å€‹æ¡ˆåˆ—è¡¨
â”œâ”€â”€ /cases/{id}              # å€‹æ¡ˆè©³æƒ…
â””â”€â”€ /reports                 # å ±è¡¨
```

---

## ğŸ“Š è³‡æ–™åº«è¡¨çµæ§‹

### æ ¸å¿ƒè¡¨
- `Cases` - å€‹æ¡ˆä¸»è¡¨
- `CaseDetail` - å€‹æ¡ˆè©³ç´°è³‡è¨Š
- `CaseHistory` - å€‹æ¡ˆæ­·å²è¨˜éŒ„

### é¸é …è¡¨
- `Cities` - åŸå¸‚
- `Districts` - å€åŸŸ
- `Schools` - å­¸æ ¡
- `OptionSets` - é¸é …é›†
- `OptionSetValues` - é¸é …å€¼

### å¯©è¨ˆè¡¨
- `DataChangeLog` - è³‡æ–™è®Šæ›´è¨˜éŒ„
- `UserActivityLog` - ä½¿ç”¨è€…æ´»å‹•è¨˜éŒ„

---

## ğŸ”§ æŠ€è¡“éœ€æ±‚

### å·²å®‰è£å¥—ä»¶
- Entity Framework Core
- Azure Key Vault ç›¸é—œå¥—ä»¶

### éœ€è¦æ–°å¢å¥—ä»¶
- FluentValidation (è³‡æ–™é©—è­‰)
- AutoMapper (ç‰©ä»¶å°æ‡‰)
- Swagger/OpenAPI (API æ–‡ä»¶)
- Serilog (æ—¥èªŒè¨˜éŒ„)
- JWT èªè­‰å¥—ä»¶

---

## ğŸ“… æ™‚ç¨‹è¦åŠƒ

| é€±æ¬¡ | ä¸»è¦ä»»å‹™ | é æœŸç”¢å‡º |
|------|----------|----------|
| 1 | Controllers + Services | åŸºæœ¬ CRUD API |
| 2 | DTOs + é©—è­‰ | å®Œæ•´ API åŠŸèƒ½ |
| 3 | èªè­‰ç³»çµ± | å®‰å…¨æ©Ÿåˆ¶ |
| 4 | MVC é é¢ | ç®¡ç†ä»‹é¢ |
| 5 | æ¸¬è©¦ + å„ªåŒ– | å®Œæ•´ç³»çµ± |

---

## ğŸ¯ æˆåŠŸæŒ‡æ¨™

- [ ] æ‰€æœ‰å€‹æ¡ˆç®¡ç†åŠŸèƒ½ API å®Œæˆ
- [ ] MVC ç®¡ç†ä»‹é¢å¯æ­£å¸¸ä½¿ç”¨
- [ ] èªè­‰å’Œæˆæ¬Šæ©Ÿåˆ¶é‹ä½œæ­£å¸¸
- [ ] è³‡æ–™é©—è­‰å®Œæ•´
- [ ] éŒ¯èª¤è™•ç†å®Œå–„
- [ ] æ•ˆèƒ½ç¬¦åˆéœ€æ±‚

---

*æœ€å¾Œæ›´æ–°ï¼š2024-09-08*
