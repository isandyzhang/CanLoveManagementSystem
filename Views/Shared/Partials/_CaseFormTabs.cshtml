@{
    // 期望 ViewData/ViewBag 提供：
    // - CurrentPage: "Create" | "Search" | "Review"
    // - CurrentTab:  "CaseBasic" | "CaseOpening" | "CareVisitRecord" | "Consultation"
    // - TypeCounts (僅 Review 顯示數字): IDictionary<string,int>
    var currentPage = (ViewBag.CurrentPage as string) ?? (ViewData["CurrentPage"] as string) ?? "Create";
    var currentTab = (ViewBag.CurrentTab as string) ?? (ViewData["CurrentTab"] as string) ?? "CaseBasic";
    var typeCounts = ViewBag.TypeCounts as System.Collections.Generic.IDictionary<string, int>;

    string PageHref(string tab)
    {
        if (string.Equals(currentPage, "Review", System.StringComparison.OrdinalIgnoreCase))
        {
            // 各分頁各自審核頁
            return tab switch
            {
                "CaseBasic" => Url.Action("Review", "CaseBasic") ?? "#",
                "CaseOpening" => Url.Action("Review", "CaseOpening") ?? "#",
                "CareVisitRecord" => Url.Action("Review", "CaseCareVisit") ?? "#",
                "Consultation" => Url.Action("Review", "CaseConsultation") ?? "#",
                _ => Url.Action("Review", "CaseBasic") ?? "#"
            };
        }
        if (string.Equals(currentPage, "Search", System.StringComparison.OrdinalIgnoreCase))
        {
            // 各分頁各自查詢頁
            return tab switch
            {
                "CaseBasic" => Url.Action("Query", "CaseBasic") ?? "#",
                "CaseOpening" => Url.Action("Query", "CaseOpening") ?? "#",
                "CareVisitRecord" => Url.Action("Query", "CaseCareVisit") ?? "#",
                "Consultation" => Url.Action("Query", "CaseConsultation") ?? "#",
                _ => Url.Action("Query", "CaseBasic") ?? "#"
            };
        }
        // Create 頁
        return tab switch
        {
            "CaseBasic" => Url.Action("Create", "CaseBasic") ?? "#",
            "CaseOpening" => Url.Action("Create", "CaseOpening") ?? "#",
            "CareVisitRecord" => Url.Action("Create", "CaseCareVisit") ?? "#",
            "Consultation" => Url.Action("Create", "CaseConsultation") ?? "#",
            _ => Url.Action("Create", "CaseBasic") ?? "#"
        };
    }

    string ActiveColorClasses(string tab)
    {
        // 依分頁指定主色（淺色背景 + 有色邊框 + 深色字）
        return tab switch
        {
            "CaseBasic" => "bg-[#EAF5D8] text-slate-900 border-[#9CCC65]",
            "CaseOpening" => "bg-[#FFF1E6] text-slate-900 border-[#FDBA74]",
            "CareVisitRecord" => "bg-[#FDE7EF] text-slate-900 border-[#F9A8D4]",
            "Consultation" => "bg-[#E6F3FF] text-slate-900 border-[#93C5FD]",
            _ => "bg-white text-primary border-primary"
        };
    }

    string TabClasses(string tab)
    {
        var isActive = currentTab == tab;
        var baseCls = "inline-flex justify-center w-full items-center gap-2 px-6 py-3 rounded-full transition-colors duration-150";
        if (isActive)
        {
            // 選中：依分頁給不同淺色底與邊框色
            return baseCls + " border shadow-card-lg " + ActiveColorClasses(tab) + " ";
        }
        else
        {
            return baseCls + " text-slate-600 hover:text-slate-800 border border-transparent hover:border-slate-300";
        }
    }

    int CountOf(string key)
    {
        if (typeCounts == null) return 0;
        return typeCounts.ContainsKey(key) ? typeCounts[key] : 0;
    }
}

<div class="mb-4">
    <ul class="flex w-full -mb-px text-lg font-medium text-center gap-4">
        <li class="flex-1">
            <a class="@TabClasses("CaseBasic")" href="@PageHref("CaseBasic")">
                <i class="bi bi-person-lines-fill"></i>
                個案基本資料
                @if (string.Equals(currentPage, "Review", System.StringComparison.OrdinalIgnoreCase))
                {
                    <span class="badge-pill bg-muted">@CountOf("CaseBasic")</span>
                }
            </a>
        </li>
        <li class="flex-1">
            <a class="@TabClasses("CaseOpening")" href="@PageHref("CaseOpening")">
                <i class="bi bi-clipboard-check"></i>
                開案紀錄表
                @if (string.Equals(currentPage, "Review", System.StringComparison.OrdinalIgnoreCase))
                {
                    <span class="badge-pill bg-muted">@CountOf("CaseOpening")</span>
                }
            </a>
        </li>
        <li class="flex-1">
            <a class="@TabClasses("CareVisitRecord")" href="@PageHref("CareVisitRecord")">
                <i class="bi bi-heart"></i>
                關懷訪視記錄表
                @if (string.Equals(currentPage, "Review", System.StringComparison.OrdinalIgnoreCase))
                {
                    <span class="badge-pill bg-muted">@CountOf("CareVisitRecord")</span>
                }
            </a>
        </li>
        <li class="flex-1">
            <a class="@TabClasses("Consultation")" href="@PageHref("Consultation")">
                <i class="bi bi-chat-dots"></i>
                會談服務紀錄表
                @if (string.Equals(currentPage, "Review", System.StringComparison.OrdinalIgnoreCase))
                {
                    <span class="badge-pill bg-muted">@CountOf("Consultation")</span>
                }
            </a>
        </li>
    </ul>
</div>

