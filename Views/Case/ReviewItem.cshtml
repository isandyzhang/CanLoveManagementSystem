@model object
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    var reviewType = (string?)ViewBag.ReviewType ?? "CaseBasic";
    var reviewId = (int?)ViewBag.ReviewId ?? 0;
    var caseId = (string?)ViewBag.CaseId ?? string.Empty;
    var caseName = (string?)ViewBag.CaseName ?? string.Empty;

    // 麵包屑：個案管理 > 個案審核 > {caseId} {caseName}
    ViewData["Breadcrumbs"] = new List<(string Text, string Url)>
    {
        ("個案管理", Url.Action("Index", "Case") ?? string.Empty),
        ("個案審核", Url.Action("Review", "Case") ?? string.Empty),
        ($"{caseId} {caseName}", string.Empty)
    };
}

<div class="w-full px-4 sm:px-6 lg:px-8">
    <div class="max-w-[1400px] mx-auto">
        <div class="card bg-white dark:bg-white rounded-xl shadow-card-lg border-0">
            <div class="px-6 py-6 border-b border-border">
                <h3 class="text-xl font-semibold leading-tight mb-0 text-slate-900">
                    @if (string.Equals(reviewType, "CaseOpening", StringComparison.OrdinalIgnoreCase))
                    {
                        <text>審閱：開案紀錄表</text>
                    }
                    else
                    {
                        <text>審閱：個案基本資料</text>
                    }
                </h3>
            </div>

            <div class="px-6 py-6">
                @if (string.Equals(reviewType, "CaseBasic", StringComparison.OrdinalIgnoreCase))
                {
                    var basic = Model as CanLove_Backend.Data.Models.Core.Case;
                    if (basic != null)
                    {
                        <form asp-action="UpdateBasic" asp-controller="Case" method="post" class="space-y-4">
                            @Html.AntiForgeryToken()
                            <input type="hidden" name="CaseId" value="@basic.CaseId" />

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-lg font-medium mb-2 text-slate-900">姓名</label>
                                    <input name="Name" value="@basic.Name" class="input" />
                                </div>
                                <div>
                                    <label class="block text-lg font-medium mb-2 text-slate-900">性別</label>
                                    <select name="Gender" class="input">
                                        <option value="" selected="@(string.IsNullOrEmpty(basic.Gender) ? "selected" : null)">請選擇性別</option>
                                        <option value="M" selected="@(basic.Gender=="M"?"selected":null)">男</option>
                                        <option value="F" selected="@(basic.Gender=="F"?"selected":null)">女</option>
                                        <option value="O" selected="@(basic.Gender=="O"?"selected":null)">其他</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-lg font-medium mb-2 text-slate-900">出生日期</label>
                                    <input type="date" name="BirthDate" value="@(basic.BirthDate == default ? "" : basic.BirthDate.ToString("yyyy-MM-dd"))" class="input" />
                                </div>
                                <div>
                                    <label class="block text-lg font-medium mb-2 text-slate-900">電話</label>
                                    <input name="Phone" value="@basic.Phone" class="input" />
                                </div>
                                <div>
                                    <label class="block text-lg font-medium mb-2 text-slate-900">Email</label>
                                    <input name="Email" value="@basic.Email" class="input" />
                                </div>
                                <div class="md:col-span-2">
                                    <label class="block text-lg font-medium mb-2 text-slate-900">地址</label>
                                    <input name="Address" value="@basic.Address" class="input" />
                                </div>
                            </div>

                            @* 不提供獨立儲存：依需求移除 *@
                        </form>
                        <div class="mt-6 flex justify-end gap-3">
                            <form method="post" asp-action="ReviewItemDecision" asp-controller="Case" style="display: inline;">
                                @Html.AntiForgeryToken()
                                <input type="hidden" name="reviewId" value="@reviewId" />
                                <input type="hidden" name="approved" value="true" />
                                <button type="submit" class="btn" style="background-color: #16a34a; color: white;">
                                    <i class="bi bi-check-circle me-1"></i>通過
                                </button>
                            </form>
                            <form method="post" asp-action="ReviewItemDecision" asp-controller="Case" style="display: inline;">
                                @Html.AntiForgeryToken()
                                <input type="hidden" name="reviewId" value="@reviewId" />
                                <input type="hidden" name="approved" value="false" />
                                <button type="submit" class="btn" style="background-color: #dc2626; color: white;">
                                    <i class="bi bi-x-circle me-1"></i>拒絕
                                </button>
                            </form>
                        </div>
                    }
                }
                else if (string.Equals(reviewType, "CaseOpening", StringComparison.OrdinalIgnoreCase))
                {
                    <div class="mb-4 text-slate-600">此審核項目為「開案紀錄表」。請點擊下方按鈕前往表單分頁進行編輯後再回到此頁通過/拒絕。</div>
                    <div class="mb-4">
                        <a class="btn" href="@Url.Action("Step1","CaseWizardOpenCase", new { caseId = caseId })">
                            <i class="bi bi-pencil me-1"></i>前往編輯開案資料
                        </a>
                    </div>
                    <div class="mt-6 flex justify-end gap-3">
                        <form method="post" asp-action="ReviewItemDecision" asp-controller="Case" style="display: inline;">
                            @Html.AntiForgeryToken()
                            <input type="hidden" name="reviewId" value="@reviewId" />
                            <input type="hidden" name="approved" value="true" />
                            <button type="submit" class="btn" style="background-color: #16a34a; color: white;">
                                <i class="bi bi-check-circle me-1"></i>通過
                            </button>
                        </form>
                        <form method="post" asp-action="ReviewItemDecision" asp-controller="Case" style="display: inline;">
                            @Html.AntiForgeryToken()
                            <input type="hidden" name="reviewId" value="@reviewId" />
                            <input type="hidden" name="approved" value="false" />
                            <button type="submit" class="btn" style="background-color: #dc2626; color: white;">
                                <i class="bi bi-x-circle me-1"></i>拒絕
                            </button>
                        </form>
                    </div>
                }
            </div>
        </div>
    </div>
</div>


