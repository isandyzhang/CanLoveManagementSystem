@model IEnumerable<CanLove_Backend.Data.Models.Review.CaseReviewItem>
@{
    ViewData["Title"] = "個案審核";
    var modelCount = Model?.Count() ?? 0;
    // 自訂麵包屑：個案管理 > 個案審核
    ViewData["Breadcrumbs"] = new List<(string Text, string Url)>
    {
        ("個案管理", Url.Action("Index", "Case") ?? string.Empty),
        ("個案審核", string.Empty)
    };
}

@{ ViewBag.CurrentPage = "Review"; }
<div class="w-full px-4 sm:px-6 lg:px-8">
    <div class="max-w-[1400px] mx-auto">
@Html.Partial("~/Views/Case/Partials/_CaseTabs.cshtml")

<div class="mb-2 text-sm text-slate-600">共找到 @modelCount 筆待審項目</div>

@{
    var currentTab = (ViewBag.CurrentTab as string) ?? "CaseBasic";
    var typeCounts = ViewBag.TypeCounts as System.Collections.Generic.IDictionary<string, int> ?? new Dictionary<string, int>();
    int CountOf(string key) => typeCounts.ContainsKey(key) ? typeCounts[key] : 0;
}

@* 分頁切換區由 _CaseTabs.cshtml 取代 *@
@if (TempData["SuccessMessage"] != null)
{
    <div class="mb-3 p-3 rounded-md border border-green-200 bg-green-50 text-green-800">@TempData["SuccessMessage"]</div>
}
@if (TempData["ErrorMessage"] != null)
{
    <div class="mb-3 p-3 rounded-md border border-red-200 bg-red-50 text-red-800">@TempData["ErrorMessage"]</div>
}

@if (Model != null && Model.Any())
{
    <div class="card bg-white dark:bg-slate-900 rounded-xl shadow-card-lg border border-border dark:border-slate-800">
        <div class="p-4 bg-white dark:bg-slate-900 text-slate-900 dark:text-slate-100">
            <div class="overflow-auto">
                <table class="data-table text-left w-full text-slate-900 dark:text-slate-100">
                    <thead>
                        <tr class="bg-slate-50 dark:bg-slate-800">
                            <th class="text-slate-700 dark:text-slate-300">個案編號</th>
                            <th class="text-slate-700 dark:text-slate-300">個案姓名</th>
                            <th class="text-slate-700 dark:text-slate-300">提交者</th>
                            <th class="text-slate-700 dark:text-slate-300">提交時間</th>
                            <th class="text-slate-700 dark:text-slate-300">表別</th>
                            <th class="text-slate-700 dark:text-slate-300">狀態</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model)
                        {
                            <tr class="border-b border-border dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-800">
                                <td class="text-slate-900 dark:text-slate-100">
                                    <a class="text-primary hover:underline" href="@Url.Action("ReviewItem","Case", new { id = item.ReviewId })">
                                        <code class="text-slate-900 dark:text-slate-100">@item.CaseId</code>
                                    </a>
                                </td>
                                <td class="text-slate-900 dark:text-slate-100">@item.Title</td>
                                <td>
                                    @{ 
                                        var map = ViewBag.SubmitterNameMap as System.Collections.Generic.IDictionary<string, string>;
                                        var raw = item.SubmittedBy ?? "系統";
                                        var name = (map != null && item.SubmittedBy != null && map.ContainsKey(item.SubmittedBy)) ? (map[item.SubmittedBy] ?? raw) : raw;
                                    }
                                    <span class="text-slate-900 dark:text-slate-100">@name</span>
                                </td>
                                <td class="text-slate-900 dark:text-slate-100"><datetime value="@item.SubmittedAt"></datetime></td>
                                <td class="text-slate-900 dark:text-slate-100">
                                    @{ 
                                        var typeLabel = item.Type switch
                                        {
                                            "CaseBasic" => "個案基本資料",
                                            "CaseOpening" => "開案紀錄表",
                                            "CareVisitRecord" => "關懷訪視記錄表",
                                            "Consultation" => "會談服務紀錄",
                                            _ => item.Type
                                        }; 
                                    }
                                    <span class="badge-pill bg-muted" style="font-size:14px;">@typeLabel</span>
                                </td>
                                <td class="text-slate-900 dark:text-slate-100">
                                    <span class="badge-pill" style="background-color:#FDBA74;color:#7C2D12;font-size:14px;">待審閱</span>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
}
else
{
    <div class="card bg-white dark:bg-slate-900 rounded-xl shadow-card-lg border border-border dark:border-slate-800">
        <div class="p-6">
            <div class="text-center py-10 text-slate-500 dark:text-slate-400">
                <i class="bi bi-inbox text-slate-400 dark:text-slate-500" style="font-size: 3rem;"></i>
                <h4 class="mt-3 text-slate-900 dark:text-slate-100">尚無個案資料</h4>
                <p class="text-slate-600 dark:text-slate-400">目前沒有符合條件的個案記錄</p>
            </div>
        </div>
    </div>
}
    </div>
</div>

@* 移除彈窗與相關腳本，改為直接點擊連到 ReviewForm 分頁 *@


