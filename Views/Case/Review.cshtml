@model IEnumerable<CanLove_Backend.Data.Models.Core.Case>
@{
    ViewData["Title"] = "個案審核";
    var modelCount = Model?.Count() ?? 0;
    var isReviewPage = true;
    // 自訂麵包屑：個案管理 > 個案審核
    ViewData["Breadcrumbs"] = new List<(string Text, string Url)>
    {
        ("個案管理", Url.Action("Index", "Case") ?? string.Empty),
        ("個案審核", string.Empty)
    };
}

<div class="flex justify-between items-center mb-4">
    <h2 class="text-2xl font-semibold text-slate-900 flex items-center gap-2">
        <i class="bi bi-search"></i>@ViewData["Title"]
    </h2>
    <div></div>
</div>

<div class="mb-2 text-sm text-slate-600">共找到 @modelCount 筆個案</div>

@if (Model != null && Model.Any())
{
    <div class="card bg-white dark:bg-slate-900 rounded-xl shadow-card-lg border border-border dark:border-slate-800">
        <div class="p-4 bg-white dark:bg-slate-900 text-slate-900 dark:text-slate-100">
            <div class="overflow-auto">
                <table class="data-table text-left w-full text-slate-900 dark:text-slate-100">
                    <thead>
                        <tr class="bg-slate-50 dark:bg-slate-800">
                            <th class="text-slate-700 dark:text-slate-300">個案編號</th>
                            <th class="text-slate-700 dark:text-slate-300">姓名</th>
                            <th class="text-slate-700 dark:text-slate-300">性別</th>
                            <th class="text-slate-700 dark:text-slate-300">出生日期</th>
                            <th class="text-slate-700 dark:text-slate-300">建立者</th>
                            <th class="text-slate-700 dark:text-slate-300">建立時間</th>
                            <th class="text-slate-700 dark:text-slate-300">狀態</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model)
                        {
                            <tr class="border-b border-border dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-800">
                                <td class="text-slate-900 dark:text-slate-100">
                                    <a class="text-primary hover:underline" href="@Url.Action("ReviewForm","Case", new { id = item.CaseId })">
                                        <code class="text-slate-900 dark:text-slate-100">@item.CaseId</code>
                                    </a>
                                </td>
                                <td class="text-slate-900 dark:text-slate-100">
                                    <a class="text-primary hover:underline" href="@Url.Action("ReviewForm","Case", new { id = item.CaseId })">@item.Name</a>
                                </td>
                                <td>
                                    @{ var g = (item.Gender ?? string.Empty).Trim().ToUpper(); }
                                    @if (g == "M" || g == "男")
                                    {
                                        <span class="badge-pill" style="background-color:#DBEAFE;color:#1E3A8A;font-size:14px;">男</span>
                                    }
                                    else if (g == "F" || g == "女")
                                    {
                                        <span class="badge-pill" style="background-color:#FCE7F3;color:#9D174D;font-size:14px;">女</span>
                                    }
                                    else if (g == "O" || g == "其他")
                                    {
                                        <span class="badge-pill bg-muted" style="font-size:14px;">其他</span>
                                    }
                                    else
                                    {
                                        <span class="badge-pill bg-muted" style="font-size:14px;">未設定</span>
                                    }
                                </td>
                                <td class="text-slate-900 dark:text-slate-100">@item.BirthDate.ToTaiwanDateString()</td>
                                <td>
                                    @{ var displayName = item.SubmittedBy ?? "系統"; if (displayName.Contains("@")) { displayName = displayName.Split('@')[0]; } }
                                    <small class="text-slate-900 dark:text-slate-100">@displayName</small>
                                </td>
                                <td class="text-slate-900 dark:text-slate-100"><datetime value="@item.CreatedAt"></datetime></td>
                                <td class="text-slate-900 dark:text-slate-100">
                                    <span class="badge-pill" style="background-color:#FDBA74;color:#7C2D12;font-size:14px;">待審閱</span>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
}
else
{
    <div class="card bg-white dark:bg-slate-900 rounded-xl shadow-card-lg border border-border dark:border-slate-800">
        <div class="p-6">
            <div class="text-center py-10 text-slate-500 dark:text-slate-400">
                <i class="bi bi-inbox text-slate-400 dark:text-slate-500" style="font-size: 3rem;"></i>
                <h4 class="mt-3 text-slate-900 dark:text-slate-100">尚無個案資料</h4>
                <p class="text-slate-600 dark:text-slate-400">目前沒有符合條件的個案記錄</p>
            </div>
        </div>
    </div>
}

@* 移除彈窗與相關腳本，改為直接點擊連到 ReviewForm 分頁 *@


